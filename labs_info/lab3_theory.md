# ЛР №3: Генераторы тестов на базе LFSR

## Введение

LFSR (Linear Feedback Shift Register) — регистр сдвига с линейной обратной связью — это основа **встроенного самотестирования** (BIST) цифровых систем. LFSR генерирует псевдослучайные последовательности максимальной длины (М-последовательности), которые используются как тестовые наборы.

## Основные понятия

### Регистр сдвига с обратной связью

**Структура LFSR**:
```
  ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐
──┤ D1  ├────┤ D2  ├────┤ D3  ├────┤ D4  ├──┐
  └─────┘    └─────┘    └─────┘    └─────┘  │
     ↑                      │          │     │
     │         ┌───┐        │          │     │
     └─────────┤XOR├────────┴──────────┴─────┘
               └───┘
```

**Компоненты**:
- **Триггеры (D-триггеры)** — хранят текущее состояние
- **Сумматоры по модулю 2 (XOR)** — формируют обратную связь
- **Тактовый сигнал** — синхронизирует сдвиг

### Характеристический полином

Конфигурация обратной связи описывается **характеристическим полиномом**:

**Φ(x) = 1 ⊕ c₁x ⊕ c₂x² ⊕ ... ⊕ cₘxᵐ**

где cᵢ ∈ {0,1} — коэффициенты (1 = есть связь, 0 = нет связи).

**Пример**: Φ(x) = 1 ⊕ x³ ⊕ x⁴
- Обратная связь от триггеров 3 и 4
- Степень полинома m=4
- Длина регистра = 4 триггера

### М-последовательность (максимальная последовательность)

**Определение**: Псевдослучайная последовательность **максимальной длины** L = 2ᵐ - 1, где m — степень порождающего полинома.

**Свойства**:
- Период L = 2ᵐ - 1 (для m=8: L=255)
- Все ненулевые комбинации встречаются ровно **один раз**
- Нулевое состояние (0...0) **запрещено** (выход из цикла)

## Типы полиномов

### Примитивный полином

Полином Φ(x) **примитивен**, если:
1. Он **неприводим** (не делится на полиномы меньшей степени)
2. Порождает последовательность **максимальной длины** 2ᵐ-1

**Примеры примитивных полиномов**:
```
m=3:  x³⊕x⊕1
m=4:  x⁴⊕x⊕1,  x⁴⊕x³⊕1
m=8:  x⁸⊕x⁶⊕x⁵⊕x⁴⊕1,  x⁸⊕x⁶⊕x⁵⊕x⊕1
```

### Взаимно обратные полиномы

Для полинома Φ(x) существует **обратный** Φ⁻¹(x):

**Φ⁻¹(x) = xᵐ · Φ(1/x)**

**Пример**:
```
Φ(x)    = 1⊕x³⊕x⁵
Φ⁻¹(x)  = x⁵·(1⊕(1/x)³⊕(1/x)⁵) = x⁵⊕x²⊕1 = 1⊕x²⊕x⁵
```

Если Φ(x) примитивен, то Φ⁻¹(x) **также примитивен**.

## Типы архитектур LFSR

### Type I (внешние XOR)

```
┌──┐  ┌──┐  ┌──┐  ┌──┐
│D1├──┤D2├──┤D3├──┤D4├──┐
└──┘  └─┬┘  └─┬┘  └──┘  │
       │     │          │
     ┌─┴─────┴──────────┘
     │      XOR
     └──────►
```

**Особенности**:
- XOR в цепи обратной связи
- Простая реализация
- Классическая схема Фибоначчи

### Type II (внутренние XOR)

```
     ┌──────────────┐
     ↓              │
┌──┐ XOR ┌──┐ XOR ┌──┐  ┌──┐
│D1├─────┤D2├─────┤D3├──┤D4├──
└──┘     └──┘     └──┘  └──┘
```

**Особенности**:
- XOR между триггерами
- Меньше задержек
- Схема Галуа

## Свойства М-последовательностей

### 1. Баланс символов

Для периода L = 2ᵐ - 1:
- **Единиц**: 2ᵐ⁻¹
- **Нулей**: 2ᵐ⁻¹ - 1

**Вероятности**:
- P(1) = 2ᵐ⁻¹ / (2ᵐ-1) ≈ 0.5
- P(0) = (2ᵐ⁻¹-1) / (2ᵐ-1) ≈ 0.5

### 2. Свойство серий

**Серия** — последовательность одинаковых битов.

**Распределение**:
- Серий длины 1: 2ᵐ⁻² раза (единицы), 2ᵐ⁻² - 1 раза (нули)
- Серий длины 2: 2ᵐ⁻³ раза
- Серий длины r: 2ᵐ⁻ʳ⁻¹ раза

### 3. Автокорреляция

**Свойство**: При циклическом сдвиге М-последовательности на s позиций совпадение происходит только при s=0 (или s=L).

**Формула**:
```
R(s) = { L,     если s = 0 или s = L
       { -1,    иначе
```

### 4. Свойство сдвига и сложения

При сложении по модулю 2 двух **сдвинутых** копий М-последовательности получается **та же** М-последовательность с другим сдвигом:

**{aₖ} ⊕ {aₖ₋ₛ} = {aₖ₋ᵣ}**

**Пример**:
```
{a₀}    = 0111101011001000
{a₂}    = 1110101100100001
{a₀}⊕{a₂} = {a₉} = 1001000110101001
```

### 5. Децимация

**Децимация по индексу q** — выборка каждого q-го элемента.

Если (L, q) = 1 (взаимно просты), то результат — **новая М-последовательность** того же периода.

**Пример** (L=15, q=2):
```
Исходная:     0111101011001000
Децимация×2:  0 1 1 0 1 0 0 0 → новая М-последовательность
```

## Применение LFSR в тестировании

### Генератор тестовых последовательностей

**Схема встроенного самотестирования (BIST)**:
```
┌──────┐     ┌─────────┐     ┌──────────┐
│ LFSR │────►│ Схема   │────►│ Анализ   │
│(ГТН) │     │(тестир.)│     │откликов  │
└──────┘     └─────────┘     └──────────┘
```

**Преимущества**:
- Малая аппаратная сложность (несколько триггеров + XOR)
- Высокая скорость генерации
- Не требует внешней памяти для хранения тестов
- Идеально для встроенного тестирования

### Задача ЛР3: Оптимизация начального состояния

**Проблема**: LFSR генерирует все 2ᵐ-1 комбинаций, но для покрытия всех неисправностей достаточно **подмножества**.

**Цель**: Найти начальное состояние (seed), при котором:
1. Покрываются **все** неисправности из ЛР1
2. Число тактов (длина последовательности) **минимально**

**Алгоритм**:
1. Получить тестовое множество из ЛР1
2. Для каждого начального состояния LFSR:
   - Генерировать последовательность
   - Проверять покрытие неисправностей
   - Считать такты до полного покрытия
3. Выбрать seed с минимальным числом тактов

## Матричное представление LFSR

Состояние LFSR описывается вектором **A(k) = [a₁(k), a₂(k), ..., aₘ(k)]**.

Переход к следующему состоянию:

**A(k+1) = V · A(k)**

где **V** — порождающая матрица.

**Пример для Φ(x) = 1⊕x³⊕x⁴**:
```
    ┌ 0 0 0 1 ┐
V = │ 1 0 0 1 │
    │ 0 1 0 0 │
    └ 0 0 1 0 ┘
```

**Состояние через k тактов**:
**A(k+s) = Vˢ · A(k)**

## Сравнение с детерминированными тестами

| Характеристика | Детерминированные тесты | LFSR (псевдослучайные) |
|---|---|---|
| Длина последовательности | Минимальная (по числу тестов) | Длинная (до полного покрытия) |
| Аппаратная сложность | Нужна память для всех тестов | Только регистр + XOR |
| Скорость | Ограничена памятью | Очень высокая (на частоте схемы) |
| Покрытие | 100% гарантировано | Зависит от длины последовательности |
| Стоимость | Высокая (память) | Низкая (несколько вентилей) |

## Преимущества LFSR

✅ Минимальная аппаратура (m триггеров + несколько XOR)  
✅ Высокая скорость генерации  
✅ Не требует внешней памяти  
✅ Подходит для встроенного тестирования  
✅ Статистически хорошие свойства последовательности

## Недостатки LFSR

❌ Не гарантирует покрытие всех неисправностей  
❌ Может потребоваться длинная последовательность  
❌ Плохо тестирует специфичные паттерны  
❌ Требуется тщательный выбор полинома и начального состояния

## Расширения и модификации

### Weighted LFSR
- Неравномерное распределение 0 и 1
- Для схем с неравновероятными входами

### MISR (Multiple Input Signature Register)
- Сжатие откликов схемы
- Для анализа выходной последовательности

### BILBO (Built-In Logic Block Observer)
- Совмещение генерации тестов и анализа
- Универсальный блок для BIST

## Применение в промышленности

LFSR используется в:
- **Процессорах** (встроенное самотестирование при включении)
- **Памяти** (BIST для DRAM/SRAM)
- **SoC (System-on-Chip)** (тестирование на производстве)
- **Телекоммуникациях** (генераторы последовательностей)
- **Криптографии** (потоковое шифрование — устаревший метод)

## Связь с другими методами

- **ЛР1, ЛР2** — определяют целевые тестовые наборы для покрытия
- **ЛР4, ЛР5** — маршевые тесты памяти можно реализовать через LFSR с управлением
- **Промышленные BIST** — комбинируют LFSR + детерминированные паттерны

