# ЛР №5: Тестирование ОЗУ — кодочувствительные неисправности

## Введение

Кодочувствительные неисправности (PSF — Pattern Sensitive Faults) — это класс неисправностей памяти, при которых поведение одной ячейки зависит от **содержимого или переходов в соседних ячейках**. Эти неисправности возникают из-за физической близости ячеек и паразитных связей.

## Терминология

### Базовая ячейка (Base Cell)

Ячейка, в которой **проявляется** неисправность. Обозначается **Cᵦ**.

### Соседние ячейки (Neighborhood Cells)

Ячейки, **влияющие** на базовую. Обозначаются **Cₙ**.

**Число соседей k**:
- **k = 3** (NPSF3): 2 соседа по горизонтали
- **k = 5** (NPSF5): 4 соседа (вверх, вниз, влево, вправо)
- **k = 9** (NPSF9): 8 соседей (включая диагонали)

```
Модель NPSF3:      Модель NPSF5:      Модель NPSF9:
   Cₙ  Cᵦ  Cₙ          Cₙ                Cₙ  Cₙ  Cₙ
                    Cₙ  Cᵦ  Cₙ          Cₙ  Cᵦ  Cₙ
                        Cₙ                Cₙ  Cₙ  Cₙ
```

## Классификация кодочувствительных неисправностей

### 1. Пассивные NPSF (PNPSF — Passive)

**Определение**: Содержимое соседних ячеек **блокирует** изменение базовой ячейки.

**Пример PNPSF**:
```
Соседи: 1 1 1 1
Базовая: 0 → пытаемся записать 1 → остаётся 0
```

**Причина**: Сильные паразитные ёмкостные связи от соседей «удерживают» базовую ячейку в текущем состоянии.

**Формальное описание**:
- Для определённого **паттерна** в соседях (например, все = 1)
- Базовая ячейка **не может изменить** своё состояние

### 2. Активные NPSF (ANPSF — Active)

**Определение**: **Переход** в одной соседней ячейке **изменяет** базовую ячейку.

**Пример ANPSF**:
```
Начальное:  Cₙ=0, Cᵦ=1, остальные=0
Переход:    Cₙ: 0→1
Результат:  Cᵦ: 1→0 (изменилась непреднамеренно!)
```

**Причина**: Переходные токи при переключении создают наводки на соседние битовые линии.

**Формальное описание**:
- Для определённого **начального паттерна** в соседях
- **Переход 0→1 или 1→0** в одном соседе
- Базовая ячейка **инвертируется** или устанавливается в 0/1

### 3. Статические NPSF (SNPSF — Static)

**Определение**: Для определённого **статического паттерна** в соседях базовая ячейка **принудительно устанавливается** в 0 или 1 (медленный процесс).

**Пример SNPSF**:
```
Соседи: 0 1 0 1 (специфический паттерн)
Базовая: x → через время → 0 (принудительно)
```

**Отличие от ANPSF**: Медленная установка (миллисекунды), не требует переходов.

## Модели неисправностей по числу соседей

### NPSF3 (3 ячейки)

**Конфигурация**: Базовая + 2 соседа слева/справа

**Пример дефекта**:
```
[0] [Cᵦ] [0]  →  Cᵦ не может стать 1
```

**Применимость**: Линейная организация памяти (одномерный массив).

### NPSF5 (5 ячеек)

**Конфигурация**: Базовая + 4 соседа (крест)

**Пример дефекта**:
```
    [1]
[1] [Cᵦ] [1]  →  Cᵦ блокирована в текущем состоянии
    [1]
```

**Применимость**: Матричная организация (строки × столбцы).

### NPSF9 (9 ячеек)

**Конфигурация**: Базовая + 8 соседей (включая диагонали)

**Пример дефекта**:
```
[1] [1] [1]
[1] [Cᵦ] [1]  →  Переход в любом соседе инвертирует Cᵦ
[1] [1] [1]
```

**Применимость**: Плотная упаковка (минимальные технормы, < 10 нм).

## Причины возникновения

### Физические механизмы

#### 1. Ёмкостная связь (Capacitive Coupling)

**Механизм**: Паразитная ёмкость между битовыми линиями соседних ячеек.

```
   Битовая линия 1    Битовая линия 2
        │                   │
        │ C_coupling        │
        ├───────────────────┤
        │                   │
    Ячейка 1           Ячейка 2
```

**Эффект**: Переход в ячейке 1 индуцирует ток в линии ячейки 2.

#### 2. Индуктивная связь (Inductive Coupling)

**Механизм**: Магнитное поле от тока в одной линии влияет на соседнюю.

**Эффект**: Особенно критично при высоких скоростях переключения.

#### 3. Резистивная связь (Resistive Coupling)

**Механизм**: Общие линии питания/земли для нескольких ячеек.

**Эффект**: Падение напряжения в одной ячейке влияет на соседние.

#### 4. Подпороговые токи (Subthreshold Leakage)

**Механизм**: Утечка через закрытые транзисторы (особенно при малых технормах).

**Эффект**: Заряд из одной ячейки «перетекает» в соседнюю.

### Факторы, усиливающие PSF

- **Уменьшение технормы** (< 10 нм): расстояние между ячейками уменьшается
- **Увеличение плотности** (3D NAND): вертикальная упаковка
- **Снижение напряжения питания**: меньше разница между 0 и 1
- **Высокие частоты**: переходные процессы не успевают завершиться
- **Температура**: увеличивает утечки

## Маршевые тесты для PSF

### March PS (Pattern Sensitive)

**Назначение**: Обнаружение кодочувствительных неисправностей.

**Алгоритм** (упрощённая версия):
```
⇕(w0);
⇑(r0, w1, r1);
⇑(r1, w0, r0, w1);
⇑(r1, w0, r0);
⇓(r0, w1, r1, w0);
⇓(r0, w1, r1, w0, r0);
```

**Сложность**: 23N операций

**Покрытие**: 
- ✅ PNPSF K3, K5, K9 (100%)
- ✅ ANPSF K3, K5, K9 (100%)
- ✅ SNPSF (частично)

**Идея**: Многократное чередование записи/чтения с разными паттернами в соседях.

### March C для PSF

**Базовый March C** покрывает только **некоторые** простые PSF.

**Почему недостаточно**:
- Не создаёт достаточно разнообразных паттернов
- Не проверяет все комбинации соседей
- Ориентирован на SAF, CFin, CFid

### Усиленные тесты

#### PMOVI (Pattern March with Overlapping Inversion)

**Особенность**: Специальные паттерны для инверсии соседей.

**Сложность**: 13N

**Покрытие**: ANPSF (хорошее), PNPSF (частичное)

#### March LA (Linked Address)

**Особенность**: Связывает тестирование с адресной топологией.

**Сложность**: 22N

**Покрытие**: NPSF + адресные неисправности

## Практические аспекты

### Вероятность PSF в реальных системах

**Современные технормы**:
- **28 нм и выше**: PSF редки (< 0.1% дефектов)
- **14-22 нм**: PSF заметны (~1-5% дефектов)
- **7 нм и ниже**: PSF критичны (~10-20% дефектов)
- **3D NAND**: PSF доминируют (> 30% дефектов)

### Стратегии тестирования

#### Для малых критичных памятей

**Подход**: Полный тест с March PS или аналогами.

**Обоснование**: Надёжность важнее времени.

#### Для больших некритичных памятей

**Подход**: Быстрый тест (MATS++) + ECC (коррекция ошибок).

**Обоснование**: ECC исправляет одиночные ошибки, время важнее покрытия.

#### Для массового производства

**Подход**: Многоуровневое тестирование.

1. **Wafer-level**: MATS++ (быстро, отбраковка явных дефектов)
2. **Package-level**: March C (средний уровень)
3. **Burn-in**: March PS при повышенной температуре (обнаружение скрытых PSF)

## Сравнение покрытия

| Тест | Сложность | SAF | CFin | CFid | PNPSF | ANPSF |
|---|---|---|---|---|---|---|
| MATS++ | 6N | ✓ | ✓ | ✓* | — | — |
| March C | 11N | ✓ | ✓ | ✓* | — | ✓* |
| PMOVI | 13N | ✓ | ✓ | ✓ | ✓* | ✓ |
| March LA | 22N | ✓ | ✓ | ✓ | ✓ | ✓ |
| March PS | 23N | ✓ | ✓ | ✓ | ✓ | ✓ |

✓ — полное покрытие, ✓* — частичное покрытие

## Моделирование PSF

### Задача ЛР5

**Цель**: Оценить покрывающую способность тестов для PNPSF и ANPSF.

**Процедура**:
1. Создать массив ячеек с топологией (соседство)
2. Сгенерировать случайные сценарии PSF:
   - Случайная базовая ячейка
   - Случайный паттерн в соседях
   - Тип неисправности (PNPSF или ANPSF)
3. Прогнать тесты (MATS++, March PS)
4. Подсчитать, сколько неисправностей обнаружено

**Критерий обнаружения**:
- Для PNPSF: создать блокирующий паттерн, попытаться записать противоположное
- Для ANPSF: создать начальный паттерн, выполнить переход в соседе

## Технологические тренды

### Влияние технологий на PSF

#### 3D NAND (вертикальная память)

**Проблема**: Ячейки расположены вертикально → новые виды соседства.

**Решение**: Специальные 3D-тесты (March Z, March 3D).

#### FinFET транзисторы

**Проблема**: Трёхмерная структура транзисторов → сложные паразитные связи.

**Решение**: Усиленные PSF-тесты + on-die ECC.

#### ReRAM, MRAM (новые типы памяти)

**Проблема**: Специфичные физические эффекты (магнитные поля, фазовые переходы).

**Решение**: Разработка новых моделей неисправностей.

### ECC (Error Correction Code)

**Современный подход**: Комбинация тестирования + ECC.

**Схема**:
```
┌───────┐   ECC encode   ┌──────┐
│ Data  │──────────────►│Memory│
└───────┘                └──────┘
                           │
                     ECC decode
                           │
                           ▼
                    ┌──────────────┐
                    │ Corrected    │
                    │ Data + Flag  │
                    └──────────────┘
```

**Типы ECC**:
- **SEC (Single Error Correction)**: исправляет 1 ошибку
- **DED (Double Error Detection)**: обнаруживает 2 ошибки
- **SEC-DED**: исправляет 1, обнаруживает 2
- **Chipkill**: исправляет отказ целого чипа

**Преимущества**:
- Позволяет использовать более быстрые (неполные) тесты
- Исправляет ошибки в процессе работы
- Увеличивает надёжность

**Недостатки**:
- Дополнительная площадь (~10-15% для SEC-DED)
- Задержка (декодирование ECC)
- Энергопотребление

## Выводы

✅ Кодочувствительные неисправности — критичны для современных технормов  
✅ March PS обеспечивает полное покрытие PNPSF/ANPSF  
✅ Для массового производства: комбинация быстрых тестов + ECC  
✅ Для критичных систем: полные тесты (March PS, March LA)  
✅ Тренд: увеличение доли PSF с уменьшением технорм

## Связь с другими лабораторными

- **ЛР4** — базовые неисправности (SAF, CFin, CFid)
- **ЛР3 (LFSR)** — псевдослучайные паттерны могут не покрывать PSF эффективно
- **Промышленные MBIST** — включают упрощённые PSF-тесты для баланса времени и покрытия

